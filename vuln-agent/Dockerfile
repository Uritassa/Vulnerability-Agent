FROM debian:buster-slim

USER root


RUN apt update && \
    apt install -y python3 \
    python3-pip \
    python3-venv \
    curl

RUN python3 -m venv /venv
ENV PATH="/venv/bin:$PATH"    

COPY requirements.txt .
RUN pip install -r requirements.txt

RUN curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl" && \
    chmod +x kubectl && \
    mv kubectl /usr/local/bin/kubectl

COPY app.py .
COPY run.sh .

RUN chmod +x run.sh

CMD ["./run.sh"]